- content_for :full_layout, true
- content_for :dark_layout, true
- content_for :footer do
  = render :partial => 'applications/footer'

- content_for :top do
  .grid-wrapper.section-header
    %nav.span12.span-flush-right
      %h1 Applications

%section#app-list.span12
  %header
    %h3.invisible Application list
  .row.tile-dark
    - groups = @applications.group_by{ |a| a.domain_id }
    - groups.each_pair do |domain_id, apps|
      - if groups.length > 1
        .grid-wrapper
          .span12.domain{:style => 'padding: 2px 10px; margin-bottom: 8px;'}
            Domain
            = link_to domain_id, domain_path(domain_id)
            - if owner = apps.first.members.find(&:owner)
              (#{owner.name})

      - apps.each do |application|
        .grid-wrapper.tile-click
          .span12.application-info{ :class => application.owner?(current_user) ? 'application-owned' : nil }
            %h2.flow
              - if application.aliases.present?
                = link_to application_path(application), :class => 'tile-target flow-block' do
                  = application.aliases.first.name
                  = '/'
                  = application.name
                  -# if application.aliases.length > 1
                    %span{:title => "Also aliased to #{application.aliases[1..-1].map(&:name).to_sentence}"} ...
              - else
                = link_to application.name, application_path(application), :class => 'tile-target'

              %span.flow-block.right
                %span.gear{:title => application_gear_count(application)}
                  = application.gear_count
                  %span.gear-icon{'aria-hidden'=>"true", 'data-icon' => "\ue014"}
                  - if (scales = application.cartridges.select(&:has_scale_range?)) and scales.present?
                    .gauge-vertical>
                      -# binding.pry
                      - if scales.none?(&:can_scale_up?)
                        %span.gauge-tick.fill>  .
                        %span.gauge-tick.fill>  .
                        %span.gauge-tick.fill>  .
                      - elsif scales.none?(&:can_scale_down?)
                        %span.gauge-tick.empty> .
                        %span.gauge-tick.empty> .
                        %span.gauge-tick.fill>  .
                      - else
                        %span.gauge-tick.empty> .
                        %span.gauge-tick.fill>  .
                        %span.gauge-tick.fill>  .

                = link_to ' ', application.web_url, :target => '_blank', 'aria-hidden'=>"true", 'data-icon' => "\uee26", :class => 'url', :title => "Go to the application's web page"
                %span.tile-arrow{"aria-hidden" => "true", "data-icon" => "\ue007"}

            .cartridges= application.cartridges.map(&:display_name).join(', ')

  .btn-toolbar.base
    = link_to application_types_path, :class => 'btn btn-primary btn-large' do
      Add
      %strong Application
      %i.icon-add

-# FIXME: Refactor me into an unobtrusive javascript function
- content_for :javascripts do
  :javascript
    jQuery('.tile-click').click(function(evt) {
      if ((t = $(evt.target)) && t.is('a')) { return }
      a = $('h2 > a', this)[0];
      window.location = a.href
    });
